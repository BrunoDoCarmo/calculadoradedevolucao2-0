<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Importar XML e Exibir Nota Fiscal</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
        .header { font-weight: bold; margin-bottom: 10px; }
        input[type="file"] { margin-bottom: 20px; }
    </style>
</head>
<body>

    <h1>Importar XML e Exibir Nota Fiscal</h1>

    <input type="file" id="fileInput" accept=".xml">
    <div class="header">Informações da Nota Fiscal</div>
    <table>
        <tr>
            <th>Código UF</th>
            <td id="cUF"></td>
        </tr>
        <tr>
            <th>Número da Nota</th>
            <td id="nNF"></td>
        </tr>
        <tr>
            <th>Data de Emissão</th>
            <td id="dhEmi"></td>
        </tr>
        <tr>
            <th>Razão Social (Emitente)</th>
            <td id="xNomeEmit"></td>
        </tr>
        <tr>
            <th>CNPJ (Emitente)</th>
            <td id="CNPJEmit"></td>
        </tr>
        <tr>
            <th>Razão Social (Destinatário)</th>
            <td id="xNomeDest"></td>
        </tr>
        <tr>
            <th>CNPJ (Destinatário)</th>
            <td id="CNPJDest"></td>
        </tr>
    </table>

    <div class="header">Detalhes dos Produtos</div>
    <table id="productsTable">
        <thead>
            <tr>
                <th>Código do Produto</th>
                <th>Descrição</th>
                <th>Quantidade</th>
                <th>Valor Unitário</th>
                <th>Valor Total</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const xmlString = e.target.result;
                    processXML(xmlString);
                };
                reader.readAsText(file);
            }
        });

        function processXML(xmlString) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlString, "application/xml");

            // Extract values from XML
            const cUF = xmlDoc.querySelector('ide > cUF').textContent;
            const nNF = xmlDoc.querySelector('ide > nNF').textContent;
            const dhEmi = xmlDoc.querySelector('ide > dhEmi').textContent;
            const xNomeEmit = xmlDoc.querySelector('emit > xNome').textContent;
            const CNPJEmit = xmlDoc.querySelector('emit > CNPJ').textContent;
            const xNomeDest = xmlDoc.querySelector('dest > xNome').textContent;
            const CNPJDest = xmlDoc.querySelector('dest > CNPJ').textContent;

            // Format the date
            const formattedDhEmi = formatDate(dhEmi);

            // Populate the table with values
            document.getElementById('cUF').textContent = cUF;
            document.getElementById('nNF').textContent = nNF;
            document.getElementById('dhEmi').textContent = formattedDhEmi;
            document.getElementById('xNomeEmit').textContent = xNomeEmit;
            document.getElementById('CNPJEmit').textContent = CNPJEmit;
            document.getElementById('xNomeDest').textContent = xNomeDest;
            document.getElementById('CNPJDest').textContent = CNPJDest;

            // Populate products table
            const products = xmlDoc.querySelectorAll('det');
            const tbody = document.querySelector('#productsTable tbody');
            tbody.innerHTML = ''; // Clear previous data

            products.forEach(product => {
                const cProd = product.querySelector('prod > cProd').textContent;
                const xProd = product.querySelector('prod > xProd').textContent;
                const qCom = product.querySelector('prod > qCom').textContent;
                const vUnCom = product.querySelector('prod > vUnCom').textContent;
                const vProd = product.querySelector('prod > vProd').textContent;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${cProd}</td>
                    <td>${xProd}</td>
                    <td>${qCom}</td>
                    <td>${vUnCom}</td>
                    <td>${vProd}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function formatDate(dateString) {
            // Example format: 2024-07-28T15:30:00Z
            const date = new Date(dateString);
            const day = String(date.getUTCDate()).padStart(2, '0');
            const month = String(date.getUTCMonth() + 1).padStart(2, '0');
            const year = date.getUTCFullYear();
            return `${day}/${month}/${year}`;
        }
    </script>

</body>
</html>
